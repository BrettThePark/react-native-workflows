var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.Clock=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _dateFns=require("date-fns");var timeTravelOffset=0;var frozenTime;var internalNow=function internalNow(){if(frozenTime){return frozenTime;}return(0,_dateFns.subMilliseconds)(new Date(),timeTravelOffset);};var now=function now(){return internalNow();};var assertInTest=function assertInTest(){if(process.env.NODE_ENV!=='test'){throw new Error('Time travel is only allowed in tests!');}};var timeTravel=function timeTravel(time){return _regenerator.default.async(function timeTravel$(_context){while(1){switch(_context.prev=_context.next){case 0:assertInTest();timeTravelOffset=(0,_dateFns.differenceInMilliseconds)(new Date(),typeof time==='string'?new Date(time):time);frozenTime=undefined;case 3:case"end":return _context.stop();}}},null,null,null,Promise);};var restoreTime=function restoreTime(){return _regenerator.default.async(function restoreTime$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:assertInTest();timeTravelOffset=0;frozenTime=undefined;case 3:case"end":return _context2.stop();}}},null,null,null,Promise);};var freezeTime=function freezeTime(time){return _regenerator.default.async(function freezeTime$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:assertInTest();if(!time){_context3.next=4;break;}_context3.next=4;return _regenerator.default.awrap(timeTravel(time));case 4:frozenTime=internalNow();case 5:case"end":return _context3.stop();}}},null,null,null,Promise);};var unfreezeTime=function unfreezeTime(){return _regenerator.default.async(function unfreezeTime$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:assertInTest();frozenTime=undefined;case 2:case"end":return _context4.stop();}}},null,null,null,Promise);};var Clock={now:now,Testing:{timeTravel:timeTravel,restoreTime:restoreTime,freezeTime:freezeTime,unfreezeTime:unfreezeTime}};exports.Clock=Clock;
//# sourceMappingURL=clock.js.map